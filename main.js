(()=>{"use strict";const e=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keydown",r)},t=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)},r=e=>{const r=document.querySelectorAll(".popup");"Escape"===e.key&&r.forEach((e=>{e.classList.contains("popup_is-opened")&&t(e)}))},o=e=>{(e.target.classList.contains("popup__close")||e.target.classList.contains("popup"))&&t(e.currentTarget)},a={baseUrl:"https://nomoreparties.co/v1/wff-cohort-23",headers:{authorization:"1c20f677-0b77-4b2d-885f-f8d61e141bf8","Content-Type":"application/json"}},n=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),s=(e,t)=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:a.headers}).then(n),c=document.querySelector("#card-template").content,l=(e,{deleteCard:t,likeCard:r,openImagePopup:o},a)=>{const n=c.querySelector(".card").cloneNode(!0),s=n.querySelector(".card__title"),l=n.querySelector(".card__image"),i=n.querySelector(".card__delete-button"),u=n.querySelector(".card__like-counter");l.alt=e.name,s.textContent=e.name,l.src=e.link,i.addEventListener("click",t),n.addEventListener("click",o),n.id=e._id,e.owner._id!==a&&i.classList.add("card__delete-button-hidden");const d=e.likes.length||0;u.textContent=d;const p=n.querySelector(".card__like-button");return p.addEventListener("click",(()=>r(p,n))),e.likes.some((e=>e._id===a))&&p.classList.add("card__like-button_is-active"),n},i=e=>{const t=e.target.closest(".places__item");var r;(r=t.id,fetch(`${a.baseUrl}/cards/${r}`,{method:"DELETE",headers:a.headers}).then(n)).then(t.remove()).catch((e=>console.log(`Ошибка удаления карточки: ${e}`)))},u=(e,t)=>{const r=e.classList.contains("card__like-button_is-active"),o=t.id,a=t.querySelector(".card__like-counter");r?r&&s(o,!0).then((t=>{e.classList.remove("card__like-button_is-active");const r=t.likes.length||0;a.textContent=r})).catch((e=>console.log(`Ошибка: ${e}`))):s(o,!1).then((t=>{e.classList.add("card__like-button_is-active");const r=t.likes.length||0;a.textContent=r})).catch((e=>console.log(`Ошибка: ${e}`)))},d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},p=(e,t,r)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent=""},_=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add(r.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},m=(e,t)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t,d):((e,t,r,o)=>{const a=e.querySelector(`.${t.id}-error`);t.classList.add(o.inputErrorClass),a.textContent=r,a.classList.add(o.errorClass)})(e,t,t.validationMessage,d)},y=(e,t)=>{const r=e.querySelector(t.submitButtonSelector),o=Array.from(e.querySelectorAll(t.inputSelector));o.forEach((r=>{p(e,r,t)})),e.reset(),_(o,r,t)},h=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__add-button"),b=document.querySelector(".popup__image"),S=document.querySelector(".popup__input_type_card-name"),f=document.querySelector(".popup__input_type_url"),q=document.querySelector(".popup__input_type_name"),g=document.querySelector(".popup__input_type_description"),C=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),k=document.querySelectorAll(".popup"),E=document.querySelector(".popup_type_edit"),$=document.querySelector(".popup_type_new-card"),x=document.querySelector(".popup_type_image"),A=document.querySelector(".places__list"),P=document.querySelector(".popup_type_edit .popup__form"),U=document.querySelector(".popup_type_new-card .popup__form"),T=document.querySelector(".popup_type_avatar"),w=document.querySelector(".popup_type_avatar .popup__form"),B=document.querySelector(".profile__image"),D=T.querySelector(".popup__input_type_url-avatar");let I=null;Promise.all([fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then(n),fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then(n)]).then((([e,t])=>{I=t._id,C.textContent=t.name,L.textContent=t.about,B.style.backgroundImage=`url(${t.avatar})`,e.forEach((e=>{A.append(l(e,{deleteCard:i,likeCard:u,openImagePopup:O},I))}))})).catch((e=>console.log(`Ошибка: ${e}`))),k.forEach((e=>{e.addEventListener("click",o)})),k.forEach((e=>{e.classList.add("popup_is-animated")}));const N=(e,t)=>{e.textContent=t},O=t=>{const r=t.target;if(r.classList.contains("card__image")){const t=r.getAttribute("src"),o=r.getAttribute("alt"),a=x.querySelector(".popup__caption");b.setAttribute("src",t),b.setAttribute("alt",o),a.textContent=b.alt,e(x)}};h.addEventListener("click",(()=>{y(P,d),q.value=C.textContent,g.value=L.textContent,e(E)})),v.addEventListener("click",(()=>{y(U,d),U.reset(),e($)})),B.addEventListener("click",(()=>{y(w,d),y(w,d),e(T)})),w.addEventListener("submit",(e=>{var r;e.preventDefault(),N(e.submitter,"Сохранение..."),(r={avatar:D.value},fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify(r)}).then(n)).then((e=>{B.style=`background-image: url(${e.avatar})`})).catch((e=>console.log(`Ошибка: ${e}`))).finally((()=>N(e.submitter,"Сохранить"))),t(T)})),P.addEventListener("submit",(e=>{e.preventDefault(),N(e.submitter,"Сохранение..."),(({name:e,about:t})=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then(n))({name:q.value,about:g.value}).then((e=>{C.textContent=e.name,L.textContent=e.about})).catch((e=>console.log(`Ошибка: ${e}`))).finally((()=>N(e.submitter,"Сохранить"))),t(E)})),U.addEventListener("submit",(e=>{e.preventDefault(),N(e.submitter,"Сохранение...");var r;(r={name:S.value,link:f.value},fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify(r,undefined)}).then(n)).then((e=>{A.prepend(l(e,{deleteCard:i,likeCard:u,openImagePopup:O},I))})).catch((e=>console.log(`Ошибка: ${e}`))).finally((()=>N(e.submitter,"Сохранить"))),U.reset(),t($)})),(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{((e,t)=>{const r=e.querySelector(t.submitButtonSelector),o=Array.from(e.querySelectorAll(t.inputSelector));_(o,r,t),o.forEach((a=>{a.addEventListener("input",(()=>{m(e,a),_(o,r,t)}))}))})(t,e)}))})(d)})();